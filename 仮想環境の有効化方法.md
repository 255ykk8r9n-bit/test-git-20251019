# 仮想環境の有効化方法（PowerShell）

以下の2つのコマンドは、PowerShell で Python 仮想環境（venv）の Activate.ps1 を実行して仮想環境を有効化するために使います。

1. `Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass`  
   - PowerShell の実行ポリシーはスクリプト実行を制御します。既定では `Restricted` や `RemoteSigned` などでスクリプトの実行が制限されることがあります。  
   - `-Scope Process` は「現在の PowerShell プロセスだけ」に適用する設定で、プロセス終了時に元に戻ります（安全）。  
   - `Bypass` は署名なしスクリプトを含めて実行を許可します。Activate.ps1 がブロックされるのを防ぐために一時的に使います。

2. `. .\ .venv\Scripts\Activate.ps1`（注：ピリオドとパスの間にスペースが必要）  
   - 正しい書式はドットソーシング（dot-sourcing）：`. <パス>` です。例:  
     `. .\.venv\Scripts\Activate.ps1`  
   - ドットソーシングはスクリプトを「現在のセッションのスコープで」実行します。これによりスクリプト内で設定された環境変数（PATH など）や関数（`deactivate`）が現在のシェルに反映されます。  
   - `.\` はカレントディレクトリの意味。`. .\...` と書かない（つまり `. \.venv\...` のようにピリオドとスペースを入れない）と、スクリプトは子スコープで実行され、環境の変更が現在のセッションに残りません（期待どおりに「有効化」されないことがある）。

Activate.ps1 が行う主な変更
- 環境変数 `VIRTUAL_ENV` を設定する。  
- 仮想環境の `Scripts` ディレクトリを先頭に PATH に追加し、`python` を仮想環境側に切り替える。  
- `deactivate` 関数を定義して、後で簡単に仮想環境を解除できるようにする。  
- プロンプトに仮想環境名を表示する（PSPrompt の変更）。

よくある落とし穴（Gotchas）
- ユーザーが入力した `.\.venv\Scripts\Activate.ps1`（ピリオドとパスの間にスペース無し）はドットソーシングではなく、仮想環境が有効化されない原因になります。必ず `. .\...` の形式にする。  
- `Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass` は「そのシェルだけ」の設定で安全だが、永続的に解除したいなら安全性を理解した上で `CurrentUser` などを検討する。  
- 仮想環境の有効化はその PowerShell セッション限定。新しいターミナルを開くと再度有効化が必要。

確認と解除
- 有効化確認: `$env:VIRTUAL_ENV` が設定されているか、`Get-Command python` が仮想環境のパスを指しているか確認。  
- 解除: PowerShell で `deactivate` と入力（Activate.ps1 が定義した関数）。

一行で実行する例
```
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass; . .\.venv\Scripts\Activate.ps1
```